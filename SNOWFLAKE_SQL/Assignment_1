SHOW WAREHOUSES;
USE WAREHOUSE DEMO_DATAWAREHOUSE;


CREATE OR REPLACE TABLE HF_SALES_DATA
(     ORDER_ID STRING,
      ORDER_DATE STRING PRIMARY KEY,
      SHIP_DATE STRING,
      SHIP_MODE VARCHAR(50),
      CUSTOMER_NAME VARCHAR(25),
      SEGMENT VARCHAR (30),
      STATE VARCHAR(60),
      COUNTRY VARCHAR(60),
      MARKET VARCHAR(30),
      REGION VARCHAR(30),
      PRODUCT_ID STRING,
      CATEGORY VARCHAR(50),
      SUB_CATEGORY VARCHAR(50),
      PRODUCT_NAME STRING,
      SALES NUMBER(10,0),
      QUANTITY INT,
      DISCOUNT FLOAT,
      PROFIT FLOAT,
      SHIPPING_COST FLOAT,
      ORDER_PRIORITY VARCHAR(25),
      YEAR INT);

DESCRIBE TABLE HF_SALES_DATA;

SELECT * FROM HF_SALES_DATA;

---1.To Drop primary key from Order_date.
ALTER TABLE HF_SALES_DATA
DROP PRIMARY KEY;

DESCRIBE TABLE HF_SALES_DATA;

--2. Changed OrderID as primary Key which was String before.
ALTER TABLE HF_SALES_DATA
ADD PRIMARY KEY (ORDER_ID);

DESCRIBE TABLE HF_SALES_DATA;



--4. EXTRACT LAST DIGIT after '-' FROM ORDER_ID AND MAKE A COLUMN AS ORDER_EXTRACT.

SELECT * , SPLIT_PART(ORDER_ID, '-',3) AS ORDER_EXTRACT FROM HF_SALES_DATA;

--5..  FLAG ,IF DISCOUNT IS GREATER THEN 0 THEN  YES ELSE FALSE AND 
--PUT IT IN NEW COLUMN FRO EVERY ORDER ID.

SELECT *,
      CASE
      WHEN DISCOUNT > 0 THEN 'YES'
      ELSE FALSE
      END AS ORDER_DISCOUNT
    
 FROM HF_SALES_DATA;
 


--3,6,7.FIND OUTTHE DATA TYPE OF ORDER_DATE AND SHIP_DATE,
--HOW MUCH DAYS TAKEN FOR EACH ORDER TO PROCESS FOR THE SHIPMENT FOR EVERY ORDER ID AND AT LAST CREATE A COLUMN RATING AS PER THE PROCAESS DAY TIME TAKEN.

CREATE OR REPLACE VIEW HF_SALES_DATA_VIEW AS
SELECT *, 
   TO_CHAR(TO_DATE(ORDER_DATE,'YYYY-MM-DD')) AS ORDER_DATE_YYYY_MM_DD, TO_CHAR(TO_DATE(SHIP_DATE,'YYYY-MM-DD')) AS SHIP_DATE_YYYY_MM_DD,
   DATEDIFF('DAY',ORDER_DATE_YYYY_MM_DD,SHIP_DATE_YYYY_MM_DD) AS PROCESS_DAY, 
    CASE
    WHEN PROCESS_DAY <= 3 THEN 5
    WHEN PROCESS_DAY <= 6 AND PROCESS_DAY >= 3 THEN 4 
    WHEN PROCESS_DAY <= 10 AND PROCESS_DAY >= 6 THEN 3
    ELSE 2
    END AS RATING
FROM HF_SALES_DATA;

 SELECT * FROM HF_SALES_DATA_VIEW;
 
